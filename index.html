<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="description" content="manfred friscic's location on the world wide web">
    <title>friscic.com</title>
    <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA10lEQVR4nO3SrUpEYRSF4VcRi2CZYLbYTGZ17zMImsXiTQgWo96CF2DzGqaZLd6AxSZYBYMGfUWZ4QzDjM75AYNnwWofz4LNB/8qIadfbV+WhZSLFIe9PJfFVuxdWQq5GsNHvT6S5Ub4nqyEDKbg3w252ZfVWnhfeim3s/Cx3hWyVgnflvWQ+znwUR/6sjEXviObIY8VcIfnekrZ+hFPKUKeq+JZjrwUcjAVDzkMea2LZznylnI8iZ+EvDfFs+xHyNmsMzXC+S1/NkDNd92A3Yls/Rd1YSKfORgRAJ68nTAAAAAASUVORK5CYII=" />
    <style type="text/css">
        * {
            font-family: monospace;
            font-size: 1.1rem;
            font-weight: bold;
            color: #41ff00;
            background-color: black;
            border-color: black;
            text-transform: uppercase;
            text-decoration: none;
            word-break: break-all;
            margin: 0.4rem 0.2rem;
        }

        body {
            width: 100vw;
            overflow-x: hidden;
            width: 100%;
            min-width: 10rem;
        }

        body::after {
            content: ' ';
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            z-index: 2;
            pointer-events: none;
            background: rgba(18, 16, 16, 0.15);
            opacity: 0;
            animation: flicker 0.15s infinite;
        }

        body::before {
            content: ' ';
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            z-index: 2;
            pointer-events: none;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg,
                    rgba(255, 0, 0, 0.06),
                    rgba(0, 255, 0, 0.02),
                    rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }

        h1 {
            text-align: right;
        }

        #loading {
            border: 2rem solid black;
            border-radius: 50%;
            border-top: 2rem solid #41ff00;
            width: 5rem;
            height: 5rem;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }

        #cursor {
            width: 1.5rem;
            height: 2rem;
            margin-left: -2rem;
            animation: blinker 1s linear infinite;
            background-color: #41ff00;
        }

        #input {
            margin-right: 2.5rem;
        }

        #navigation {
            margin: 1rem 0;
        }

        #footer {
            margin-top: 1.5rem;
            text-align: right;
        }

        .container {
            max-width: 15rem;
            margin: 0 auto;
            border-right: 0.2rem solid #41ff00;
        }

        .highlight {
            background-color: #41ff00;
            color: black;
            padding: 0 0.4rem 0 0.2rem;
            line-height: 1.4rem;
        }

        @keyframes blinker {
            50% {
                opacity: 0
            }
        }

        @keyframes flicker {
            50% {
                opacity: 0;
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1><a href="/">friscic<span class="highlight">com</span></a></h1>
        <div id="navigation"></div>
        <div id="lines"></div>
        <div id="cmdl"><span>~$<span id="input"></span><input type="text" id="cursor" value="&nbsp;"></span></div>
        <div id="footer">&nbsp;©2023&nbsp;</div>
    </div>

    <script type="text/javascript">
        const EventType = Object.freeze({
            KeyDown: "keydown",
            KeyPress: "keypress",
            Input: "input",
        });
        const Navigation = Object.freeze({
            About: "ABOUT",
            Contact: "CONTACT",
            Imprint: "IMPRINT",
        });
        const Language = Object.freeze({
            English: "en",
            Deutsch: "de"
        });
        let loading = document.getElementById("loading");
        let navigation = document.getElementById("navigation");
        let lines = document.getElementById("lines");
        let input = document.getElementById("input");
        let cursor = document.getElementById("cursor");
        let footer = document.getElementById("footer");
        let head = document.getElementsByTagName("head");
        let [language, command] = getUrlSearchParams();
        let content = {};
        let eCnt = 0;

        const addEventListener = (eventType) =>
            document.addEventListener(eventType, (event) =>
                checkInput(event, eventType)
            );

        function getUrlSearchParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get("lang") || Language.English;
            const command = urlParams.get("command")?.toUpperCase();

            return [lang, command];
        }

        function setCanonicalTag() {
            var link = document.createElement('link');
            link.rel = 'canonical';
            link.href = command ? `https://friscic.com/?lang=${language}${command}` : `https://friscic.com/?lang=${language}`;

            head[0].appendChild(link);
        }

        function translate(json) {
            Object.entries(json).forEach((entry) => {
                content[entry[0]] =
                    entry[1]?.flatMap((obj) =>
                        obj.ref
                            ? json[obj.ref].map((t) =>
                                t.text
                                    ? {
                                        ...t,
                                        text: t.text[language],
                                    }
                                    : d
                            )
                            : obj.text
                                ? {
                                    ...obj,
                                    text: obj.text[language],
                                }
                                : d
                    ) || {};
            });
        }

        const addNavigationItem = (name) => {
            const item = document.createElement("h2");
            const link = document.createElement("a");
            link.href = `?command=${name}&lang=${language}`;
            link.innerText = content[name][0]?.text;

            item.appendChild(link);
            navigation.appendChild(item);
        };

        const addLanguageSwitch = (lang) => {
            const item = document.createElement("a");
            item.href = `?lang=${lang}&command=${command || ""}`;
            item.innerText = lang;

            if (lang === language) {
                item.classList.add("highlight");
            }

            footer.append(item);
        };

        function newCommandLine(options = {}) {
            const line = document.createElement("div");

            if (options.highlight) {
                line.className += " highlight";
            }

            if (options.href) {
                let link = document.createElement("a");
                link.href = options.href;
                link.target = "_blank";
                link.innerText = options.text || "";
                line.append(link);
            } else {
                line.innerText = options.text
                    ? options.text.replace("%I", input.innerText)
                    : line.innerText;
            }

            lines.append(line);

            window.scrollTo({
                left: 0,
                top: document.body.scrollHeight,
                behavior: "smooth",
            });
        }

        const checkInput = (event, eventType) => {
            const eventId = (event.data || event.key || event.inputType)?.toUpperCase();
            cursor.value = " "; // hacking input value

            if (!eventId) {
                newCommandLine({ text: content["OOPS"][0]?.text });
            } else if (eventId === "ENTER") {
                newCommandLine({ text: `~/${input.innerText} ` });
                inputValidator();
                if (input.innerText === "CLS" || input.innerText === "CLEAR") {
                    lines.innerText = "";
                    newCommandLine({ text: content[input.innerText][0]?.text });
                }
                if (input.innerText === "ALL") {
                    lines.innerText = "";
                    newCommandLine({ text: Object.keys(content).map(k => k).join(', ') });
                }
                input.innerText = "";
                event.preventDefault();
            } else if (eventId === "DELETECONTENTBACKWARD" || eventId === "BACKSPACE") {
                input.innerText = input.innerText.substring(
                    0,
                    input.innerText.length - 1
                );
                event.preventDefault();
            } else if (eventType === EventType.KeyPress) {
                input.innerText += event.key;
                event.preventDefault();
            } else if (eventType === EventType.Input && event.data) {
                input.innerText += event.data;
                event.preventDefault();
            }
        };

        function inputValidator(inputString = input.innerText) {
            const keyMatch = Object.keys(content).find((command) =>
                inputString.match(new RegExp(`^${command}`, "gi"))
            );
            const valueMatch = content[keyMatch];

            if (!inputString && !keyMatch) {
                newCommandLine({
                    text: eCnt > 2
                        ? `${eCnt > 10 ? content["ANGRY"][0]?.text : content["CHEER"][0]?.text}【#${eCnt}】empty`
                        : content["EMPTY"][0]?.text,
                });
                eCnt++;
            } else if (valueMatch?.length) {
                valueMatch.forEach((line) => newCommandLine(line));
            } else {
                newCommandLine({ text: `'${inputString}' IS NOT RECOGNIZED` });
                eCnt = 0;
            }
        }

        (async function start() {
            setCanonicalTag();
            
            await fetch("./data.json")
                .then((response) => response.json())
                .then((json) => {
                    translate(json);

                    if (command) {
                        const text = content[command][0]?.text;
                        const currentPage = language !== Language.English ? text.substring(3, text.length) : command.toLocaleLowerCase();
                        document.title = `${currentPage} @ friscic | ${language.toLocaleLowerCase()}`;
                        inputValidator(command);
                    }

                    Object.values(Language).forEach(addLanguageSwitch);
                    Object.values(Navigation).forEach(addNavigationItem);
                    Object.values(EventType).forEach(addEventListener);
                });
        })();

        //# sourceURL=app.js
    </script>
</body>

</html>